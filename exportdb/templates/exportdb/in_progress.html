{% extends "exportdb/base.html" %}{% load i18n admin_static %}

{% block extrahead %}{{ block.super }}
<script src="{% static 'admin/js/jquery.min.js' %}" type="text/javascript"></script>
<script src="{% static 'admin/js/jquery.init.js' %}" type="text/javascript"></script>
<style type="text/css">

</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <div class="module aligned">
        <h2>{% trans "Export in progress" %}</h2>

        <div class="form-row">
            {% trans "The following object types are being exported" %}
            <ul>
                {% for model in models %}
                    <li>{{ model }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div id="progress">

    </div>

    {% comment %}
    <div class="submit-row">
        <input type="submit" value="{% trans "Confirm" %}" class="default" name="_save">
    </div>
    {% endcomment %}
</div>


<script type="text/javascript">
(function($, undefined) {
    'use strict';

    var url = '{% url 'exportdb_progress' %}';

    var updateProgress = function() {
        $.getJSON(url, function(json) {
            console.log(json);
            if (json.status == 'PROGRESS') {
                setTimeout(updateProgress, 1000);
            } else if (json.status == 'SUCCESS') {
                console.log(json.file)
            }
        });
    };

    updateProgress();

})(window.jQuery || django.jQuery);
</script>

{% endblock content %}
